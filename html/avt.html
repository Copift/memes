<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Авторизация</title>
    <link href="./../css/reg.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <h1>
      Авторизация
    </h1>
    <hr />
    <form action="" method="post">
      <table align="center">
        <tr>
          <td>
            <fieldset>
              <legend align="right"><label for="name">Имя пользователя или почта</label></legend>
              <input
                id="name"
                name="name"
                type="text"
                class="text"
                required
                size="27"
              />
            </fieldset>
          </td>
        </tr>
        <tr>
          <td>
            <fieldset>
              <legend align="right">
                <label for="pass">Пароль</label>
              </legend>
              <input
              id="pass"
              type="password"
              required
              maxlength="15"
              size="27"
              name="password"
              class = "text"
            />
            </fieldset>
          </td>
        </tr>
      </tr>
      </table>
    </form>
    <button onclick="auth()" class="return">Войти</button>
  </body>

  <script>
      // ip сервера
      const ip = '10.8.0.1:5000';

  function auth(){
    var login = document.getElementsByTagName("input")[0];
    var val1 = login.value;
    var password = document.getElementsByTagName("input")[1];
    var val2 = password.value;
    authorization(val1, val2);
  } 

  // получение uuid (КОД ДЛЯ РЕГИСТРАЦИИ, ПОТОМ УДАЛИТЬ)
  async function authorization(login, password){
      // создаём запрос
      let url = 'http://' + ip + '/auth?login=' + login + '&password=' + password;
      // оптправляем запрос
      let response = await fetch(url);

      // если прищёл правильный лответ
      if (response.ok){
          // преобразовываем запрос в json
          let commits = await response.json();

          // достаем uuid из json
          let uuid = commits.uuid;

          // возвращаем готовый uuid
          // отправка данных на другую страницу
          localStorage.setItem('UUID',uuid);
          console.log(uuid);
          document.location='./project1.html'  // ЗАМЕНИТЬ НА ПЕРЕХОД К ОСНОВНОЙ СТРАНИЦЕ С ПЕРЕДАЧЕЙ UUID

      // если пришёл ответ с ошибкой
      }else{
          // преобразовываем запрос в json
          let commits = await response.json();

          // выводим сообщение об ошибке
          alert("error " + commits.err_code + "\n" + commits.err);
      }
  }
</script>
</html>